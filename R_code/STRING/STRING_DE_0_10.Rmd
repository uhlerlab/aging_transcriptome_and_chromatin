---
title: "STRING_DE_0_10"
author: "Jana"
date: '2022-05-13'
output: BiocStyle::html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
BiocStyle::html_document 

file_path <- "/Users/janabraunger/Documents/Studium/Master/Boston/Masterarbeit/"
figdir = paste0(file_path, "Figures/STRING_DE_0_10/")
if(!dir.exists(figdir)) dir.create(figdir)
knitr::opts_chunk$set(dev = c("png", "pdf"), fig.path = figdir)
```

In this markdown the STRING network of the genes that are differentially expressed between
the 0-9 and 10-19 year-olds and the contribution of the various types of scores is analysed


```{r load_libraries, message = FALSE, warning = FALSE}
library(tidyverse)
library(magrittr )
library(ggplot2)
library(UpSetR)
```

# Load STRING interaction network

## Get list of DE proteins for the first transition
```{r}
de_data <- read.delim(paste0(file_path, "Data/fc_top10.csv"), 
                                     sep = ",", header = TRUE) %>%
  filter(transition == "fc_0_10")
head(de_data, n = 3)
```

```{r eval = FALSE}
# save file to upload on the STRING website
write.table(subset(de_data, select = gene), paste0(file_path, "Data/de_genes_0_10.txt"), 
            sep = "\n", row.names = FALSE, quote = FALSE)

# prints the list of genes to copy them onto the STRING website
# cat(de_data$gene,sep="\n")
```


## Get STRING interactions for selected genes
```{r}
interactions <- read.delim(paste0(file_path, "Data/string_interactions_physical.tsv"), sep = "\t")
head(interactions)
```

# General statistics of the score types

## Reported interactions per score
```{r score_percentages}
interactions_long <- gather(interactions, key = score_name, value = score, 
                            -c(node1, node2, node1_string_id, node2_string_id)) %>%
  filter(score != 0) %>%
  mutate(interaction = paste0(node1, "_", node2))

occurences <- filter(interactions_long, score_name != "combined_score") %>%
  group_by(score_name) %>% 
  summarize(n = n()) %>%
  mutate(percent = n / nrow(interactions)) %>%
  arrange(desc(percent))

ggplot(occurences, aes(x = reorder(score_name, percent), y = percent)) +
  geom_bar(stat="identity") + 
  coord_flip() +
  xlab("") +
  theme_bw()
```


## Distributions of the score types

**Histogram of the score types**
```{r hist_scores_non_zero}
ggplot(interactions_long, aes(x = score)) + 
  geom_histogram() + 
  facet_wrap(~score_name, scales = "free_y") +
  theme_bw()
```

**Stacked histogram**
```{r hist_scores_stacked}
ggplot(filter(interactions_long, score_name != "combined_score"), aes(x = score, fill = score_name)) + 
  geom_histogram() +
  theme_bw()
```

**Percentages of each score type per bin**
```{r hist_scores_percent}
ggplot(filter(interactions_long, score_name != "combined_score"), aes(x = score, fill = score_name)) + 
  geom_histogram(position = 'fill') +
  theme_bw()
```


## How often are multiple score types reported for an interaction?
```{r}
#split interaction_long into list of groups
top_list <- filter(interactions_long, score_name != "combined_score") %>% 
  mutate(score_name = factor(score_name, levels = unique(interactions_long$score_name))) %>%
  group_by(score_name) %>% 
  group_split()
names(top_list) <- unique(interactions_long$score_name)[1:3]
top_list <- lapply(top_list, function(list) list$interaction)

upset(fromList(top_list), order.by = "freq", nsets = 8,
       mainbar.y.label = "Intersections", sets.x.label = "Interactions",
       text.scale = c(1.5, 1.5, 1, 1, 1.5, 1.5), nintersects = 10)
```

# Degree of the nodes in the DE network
```{r}
degrees <- read.delim(paste0(file_path, "Data/string_node_degrees.tsv"), sep = "\t")
ggplot(degrees, aes(x = node_degree)) +
  geom_histogram(bins = 50) +
  xlab("Node degree")
```







